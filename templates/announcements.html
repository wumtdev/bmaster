<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Required meta tags-->
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="author" content="Pavel" />
		<meta name="keywords" content="Проект" />
		<title>Звонки в школе</title>
		<!-- shortcut icon-->
		<link
			rel="shortcut icon"
			href="static/img/logo_1.png"
			type="image/x-icon"
		/>
		<!-- Font awesome -->
		<link href="static/css/font-awesome.css" rel="stylesheet" />
		<!-- animat css-->
		<link href="static/css/animate.css" rel="stylesheet" />
		<!-- Bootstrap css-->
		<link href="static/css/bootstrap.css" rel="stylesheet" />
		<!-- Custom css-->
		<link href="static/css/style2.css" rel="stylesheet" />
		<!-- mic css-->
		<link
			href="static/css/mic/mic.css"
			rel="stylesheet"
			type="text/css"
			media="screen, projection"
		/>
	</head>
	<body>
		<!-- header start-->
		<header class="land-header fixed">
			<div class="container">
				<div class="row">
					<div class="col-12">
						<div class="header-contain position-relative">
							<div class="col-xxl-1 col-lg-1 col-2 wow fadeInUp">
								<div class="codex-brand logo-img">
									<a href="/">
										<img class="img-fluid" src="static/img/logo_2.png" alt="" />
									</a>
									<br />
									<span class="logo-title">Звонок</span>
								</div>
							</div>

							<div class="col-xxl-1 col-lg-1 col-8 wow fadeInUp">
								<div class="bread-wrap"></div>
								<span class="liveTime"></span>

								<div class="bread-wrap"></div>
								<em><span class="getDate"></span></em>
							</div>

							<div class="col-xxl-8 col-lg-8 col-2 wow fadeInUp">
								<div class="d-flex align-items-center">
									<div class="menu-block">
										<ul class="menu-list">
											<li class="d-xl-none">
												<a class="close-menu" href="javascript:void(0);">
													<div class="menu-brand">
														<img
															class="img-fluid"
															src="static/img/logo_2.png"
															alt=""
														/>
														<i data-feather="x"></i>
													</div>
												</a>
											</li>
											<li class="menu-item">
												<a href="/">
													<i data-feather="file-text"></i>
													<b>Расписание звонков</b>
												</a>
											</li>
											<li class="menu-item">
												<a href="#">
													<i data-feather="mic"></i>
													<b>Объявления</b>
												</a>
											</li>
											<li class="menu-item">
												<a href="sounds">
													<i data-feather="book-open"></i>
													<b>Библиотека звуков</b>
												</a>
											</li>
											<li class="menu-item">
												<a href="settings">
													<i data-feather="settings"></i>
													<b>Настройки</b>
												</a>
											</li>
											<li class="menu-item mob-menu">
												<a href="profile">
													<i data-feather="smile"></i>
													<b>Профиль</b>
												</a>
											</li>
										</ul>
										<a class="menu-action d-xl-none" href="javascript:void(0);">
											<i class="fa fa-bars"></i>
										</a>
									</div>
								</div>
							</div>

							<li class="nav-profile">
								<div class="media">
									<div class="user-icon"><i data-feather="user"></i></div>
									<div class="media-body">
										<h6>Романова</h6>
									</div>
								</div>
								<div class="menu-profile">
									<ul>
										<li><a href="profile">Профиль</a></li>
										<li>
											<a href="#">
												<i class="fa fa-sign-out"></i>
												Выйти
											</a>
										</li>
									</ul>
								</div>
							</li>
						</div>
					</div>
				</div>
			</div>
		</header>
		<!-- header end-->
		<!-- feathure start-->
		<section class="bg-white space-py-100" id="#">
			<div class="container">
				<div class="row">
					<div class=".col-xl-12 col-lg-12 col-12 justify-content-center">
						<div class="land-title land-title2">
							<h3 class="wow fadeInUp" data-wow-duration="1s">Объявления</h3>
						</div>
					</div>

					<div class="row cdx-row justify-content-center">
						<div class=".col-xl-6 col-lg-6 col-12 wow fadeInUp">
							<div class="user-detailwrap">
								<h2>Объявление в эфире</h2>
							</div>
							<div class="card user-card">
								<div class="card-body ads">
									<div class="user-detailwrap">
										<button id="recButton" class="recording">
											<i data-feather="mic"></i>
										</button>
										<p>
											Нажмите на кнопку, чтобы
											<br />
											<b>начать / остановить</b>
											<br />
											трансляцию
										</p>
										<div id="streamId"></div>
										<div id="listenLink"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
					
					<div class="row cdx-row justify-content-center">
						<div class=".col-xl-6 col-lg-6 col-12 wow fadeInUp">
							<div class="user-detailwrap">
								<h2>Проиграть на колонках</h2>
							</div>

							<div class="card user-card3">
								<div class="col-lg-12 col-12">
									<div
										class="col-xl-6 col-lg-6 col-sm-6 cdx-xxl-60 cdx-xl-60 melody-card"
									>
										<div class="card-body">
											<div class="form-group">
												<label class="form-label">Звуки и объявления</label>
												<select class="form-control" name="melody">
													{% for sound_specs in sounds_specs %}
													<option value="{{ sound_specs['path'] }}">{{ sound_specs['name'] }}</option>
													{% endfor %}
												</select>
											</div>
										</div>
									</div>

									<div
										class="col-xl-6 col-lg-6 col-sm-6 cdx-xxl-40 cdx-xl-40 duration-card"
									>
										<div class="card-body">
											<div class="form-group2">
												<label class="form-label">Проиграть на:</label>
												<br />
												<div class="card-button">
													<button class="btn btn-primary browserPlayButton">
														<i data-feather="volume-1"></i>
														Устройстве
													</button>
												</div>

												<div class="card-button">
													<button class="btn btn-warning externalPlayButton">
														<i data-feather="music"></i>
														Динамиках школы
													</button>
												</div>
											</div>
										</div>
										
									</div>
									
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- feathure end-->
		<!-- footer start-->
		<footer class="lan-footer space-py-100">
			<div class="container">
				<div class="row">
					<div class="col-lg-8 offset-lg-2">
						<div class="support-contain">
							<div class="codex-brand">
								<a href="#">
									<img
										class="img-fluid wow fadeInUp"
										src="static/img/logo_2.png"
										alt="theeme-logo"
									/>
								</a>
							</div>
							<h3 class="wow fadeInLeft">BellMaster</h3>
						</div>
					</div>
				</div>
			</div>
		</footer>
		<!-- footer end-->

		<!-- Feather iocns js-->
		<script src="static/js/feather.js"></script>

		<!-- Bootstrap js-->
		<script src="static/js/bootstrap.bundle.min.js"></script>

		<!-- main jquery-->
		<script src="static/js/jquery-3.6.0.js"></script>

		<!-- <script src="static/js/mic/record.js"></script> -->

		<script>
			//========== Global Helpers ==========//
			const $window = $(window);
			const $document = $(document);
		
			//========== Header Behavior ==========//
			$window.scroll(function() {
				$('header').toggleClass('sticky', $window.scrollTop() > 100);
			});
		
			//========== Menu Handling ==========//
			$document.on('click', '.menu-action', () => $('.menu-list').toggleClass('open'));
			$document.on('click', '.close-menu', () => $('.menu-list').removeClass('open'));
		
			document.addEventListener('mouseup', (e) => {
				if (!document.querySelector('.menu-list').contains(e.target)) {
					$('.menu-list').removeClass('open');
				}
			});
		
			//========== Back to Top ==========//
			$window.scroll(function() {
				$('.scroll-top').toggleClass('show', $window.scrollTop() > 450);
			});
		
			$document.on('click', '.scroll-top', () => {
				$('html, body').animate({scrollTop: 0}, 450);
			});
		
			//========== Time Display ==========//
			function updateTime() {
				const now = new Date();
				// Live Time
				const liveTime = now.toTimeString().substring(0, 8);
				$('.liveTime').text(liveTime);

			}
			setInterval(updateTime, 1000);
			updateTime();
		
			//========== Dynamic Elements Handling ==========//
			function initializeElements() {
				// Play buttons
				$document.off('click', '.browserPlayButton').on('click', '.browserPlayButton', handleBrowserPlay);
				$document.off('click', '.externalPlayButton').on('click', '.externalPlayButton', handleExternalPlay);
			}
		
			//========== Audio Handling ==========//
			function handleBrowserPlay() {
				const select = $(this).closest('tr').find('select')[0];
				const audioPlayer = document.getElementById('audioPlayer');
				const audioSource = document.getElementById('audioSource');
				const audioNameElement = document.getElementById('audioName');

				audioSource.src = `/api/${select.value}`;
				audioNameElement.textContent = select.options[select.selectedIndex].text;
				audioPlayer.load();
				
				const modal = new bootstrap.Modal('#audioModal');
				modal.show();
			}
						
			function handleExternalPlay() {
				const select = $(this).closest('tr').find('select')[0];
				fetch("/api/schedule/add_event", {
					method: 'POST',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify({
						eventType: "SOUND_TEST",
						path: select.value
					})
				}).then(response => {
					if (response.ok) {
						toast.show();
						setTimeout(location.reload, 2000);
					} else {
						throw new Error('Failed to save data');
					}
				}).catch(error => {
					console.error(error);
					toastElement.querySelector(".toast-body").textContent = 'Произошла ошибка. Попробуйте еще раз.';
				});
			}

			$('#recButton').addClass('notRec');

			$('#recButton').click(function () {
				if ($('#recButton').hasClass('notRec')) {
					$('#recButton').removeClass('notRec');
					$('#recButton').addClass('Rec');
				} else {
					$('#recButton').removeClass('Rec');
					$('#recButton').addClass('notRec');
				}
			});
			$(function() {
				initializeElements();
			});
		</script>
	</body>
</html>
